===============================
Using Telegraf with CrateDB
===============================

`Telegraf <https://github.com/influxdata/telegraf>`_ is a plugin-driven server agent for collecting & reporting metrics.


.. rubric:: Table of Contents

.. contents::
   :local:

Setup
=====

There is an open pull request for adding the CrateDB output plugin to `Telegraf <https://github.com/influxdata/telegraf>`_. 

Until this pull request is merged we provide binaries for:

- `linux 368 <https://cdn.crate.io/downloads/dist/telegraf/telegraf_0.1-170921123755.linux.386.tar.gz>`_ 
- `linux amd64 <https://cdn.crate.io/downloads/dist/telegraf/telegraf_0.1-170921123755.linux.amd64.tar.gz>`_
- `darwin amd64 <https://cdn.crate.io/downloads/dist/telegraf/telegraf_0.1-170921123755.darwin.amd64.tar.gz>`_
- `windows amd64 <https://cdn.crate.io/downloads/dist/telegraf/telegraf_0.1-170921123755.windows.amd64.tar.gz>`_

Or you can build it by yourself `Dokumentation <https://github.com/tomsvogel/telegraf#from-source>`_.


Configure and Run
=================

`SQuirreL <http://www.squirrelsql.org/>`_:

1. Download or build 

2. Create default config

   .. code-block:: bash

      ./telegraf config > telegraf.conf

3. Configure CrateDB instead of InfluxDB
   remove the Influx config and your CrateDB config

   .. code-block:: bash 

      [[outputs.cratedb]]

      # A lib/pq connection string.
      # See http://godoc.org/github.com/lib/pq#hdr-Connection_String_Parameters
      url = "postgres://crate@localhost/doc?sslmode=disable"
      # Timeout for all CrateDB queries.
      timeout = "5s"
      # Name of the table to store metrics in.
      table = "metrics"
      # If true, and the metrics table does not exist, create it automatically.
      table_create = true

4. Start

   .. code-block:: bash

      ./telegraf --config telegraf.conf
